% !TEX root=MemoriaTFG.tex

\chapter{Diseño}\label{diseño}
El correcto diseño de una infraestructura de red es un factor determinante para garantizar la eficiencia, la seguridad y la disponibilidad de los servicios en cualquier entorno,
y resulta especialmente crítico en instalaciones hospitalarias, donde el funcionamiento continuo de los sistemas de información y de los dispositivos médicos conectados puede 
tener un impacto directo en la seguridad y atención de los pacientes. Por ello, el diseño debe contemplar no solo la organización topológica de los dispositivos y enlaces, sino
también la segmentación lógica, las políticas de seguridad y la planificación de los servicios de red necesarios.
\\ \\
En este capítulo se presenta el diseño detallado de la infraestructura de red hospitalaria propuesta, partiendo de los requisitos funcionales, de seguridad y de conectividad 
definidos previamente. El diseño abarca dos niveles: por un lado, la red de interconexión entre los cuatro hospitales simulados, y por otro, el diseño específico y detallado 
de la red de uno de los hospitales, empleando técnicas de segmentación mediante VLANs y subredes diferenciadas para invitados, dispositivos IoMT y servicios internos.
\\ \\
Asimismo, se describen las decisiones adoptadas respecto a la topología física y lógica, la planificación del direccionamiento IP, la definición de las VLANs, la organización 
de los servicios de red, las políticas de seguridad implementadas y la configuración de mecanismos de redundancia y tolerancia a fallos. Todos estos elementos se han planificado
en base a los criterios de diseño establecidos en capítulos anteriores y conforme a las buenas prácticas recomendadas para entornos sanitarios.
\\ \\
Este capítulo servirá como base para la posterior implementación y simulación de la red en Cisco Packet Tracer, así como para la ejecución de pruebas de conectividad y 
seguridad orientadas a validar su funcionamiento.

\section{Criterios de Diseño}
\label{sec:criterios}
Antes de definir la infraestructura de red, se realizó un análisis de los requisitos funcionales, de seguridad y de conectividad propios de un entorno hospitalario. Este 
análisis, junto con las buenas prácticas en entornos sanitarios, permitió establecer una serie de criterios de diseño, como la segmentación mediante VLANs, el aislamiento 
de subredes críticas como IoMT, la redundancia de enlaces y gateways, y la centralización de servicios en DMZ.
\\ \\
El diseño se divide en dos niveles: una red de interconexión entre cuatro hospitales y un diseño interno detallado de un hospital, dividido en subredes y VLANs según áreas funcionales.
\\  \\
Para la red de interconexión entre hospitales, se optó por simplificar la topología de tal forma que el diseño se enfoque simplemente en la conectividad entre los hospitales, es decir,
se omiten las configuraciones de redundancia (HSRP y EtherChannel) y se simplifica la cantidad de VLANs y subredes, manteniendo la funcionalidad básica de comunicación entre ellos. Esta decisión se tomó 
para no duplicar el esfuerzo de configuración y para centrarse en mejorar las configuraciones de seguridad y conectividad entre los hospitales. 

\section{Topología de red propuesta}
En esta sección se presentan las topologías de red propuestas tanto para el Hospital Universitario Son Espases como para la red de interconexión de los cuatro hospitales, que incluye tanto la topología física como la lógica, detallando en cada caso las decisiones adoptadas
y los dispositivos seleccionados para cumplir con los requisitos de conectividad, seguridad y rendimiento.

\subsection{Topología física Son Espases}\label{subsec:topologiafisica}
La topología física representa la disposición y conexión física de routers, switches, servidores, dispositivos IoMT y departamentos.
\subsubsection{Routers}
En este diseño, como se muestra en la Figura \ref{fig:Routers}, se han implementado tres routers principales, los cuales están configurados para proporcionar 
redundancia y tolerancia a fallos mediante Hot Standby Router Protocol (HSRP). Estos routers se conectan con:

\begin{itemize}
    \item \textbf{Sw.Invitados}, que es el dispositivo que interconecta a los routers con la red de invitados.
    \item \textbf{Sw.DMZ Interno}, que conecta con el servidor que puede ser accedido desde Internet (servidor web).
    \item \textbf{\acs{ISP} 1}, que simula Internet, y será la interfaz que se usará para las comunicaciones hacia Internet.
    \item \textbf{\acs{ISP} 2}, que simula Internet, y será la interfaz que se usará para las comunicaciones desde Internet.
    \item \textbf{Sw.Core1}, que interconecta a los routers con la red interna y con la red IoMT.
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{Imágenes/Routers.png}
    \caption{Topología física de los Routers}
    \label{fig:Routers} 
\end{figure}

Todos estos dispositivos están conectados mediante enlaces GigabitEthernet usando un cable de cobre directo, excepto en el caso de las conexiones con los \ac{ISP} que se usan enlaces Serial. Además, todos se interconectan entre todos siguiendo la 
topología de malla total, con el fin de conseguir redundancia en esta parte de la red, que es la más crítica.

\subsubsection{Switch de Invitados}
El switch de invitados es el encargado de interconectar a los routers con los dispositivos de red de la red de invitados, en este caso, interconecta a dos switches de capa 2, 
mediante un enlace FastEthernet usando un cable de cobre trenzado, e interconecta con el servidor DHCP de esta subred, mediante un enlace GigabitEthernet usando un cable de cobre directo.
\\ \\
Como se puede apreciar en la Figura \ref{fig:invFIs}, estos switches de capa 2, también están conectados a dos APs, los cuales a su vez, conectan con los dispositivos finales de esta subred, mediante una conexión inalámbrica.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{Imágenes/InvitadosFis.png}
    \caption{Topología física del Switch de Invitados}
    \label{fig:invFIs} 
\end{figure}

\subsubsection{Switch de la DMZ Interna}
Como se puede apreciar en la Figura \ref{fig:dmzIntFis}, este switch de capa 2, que actúa como puerta de entrada a la DMZ, interconecta con el único servidor que es accesible desde Internet (servidor web). El enlace 
con el servidor es GigabitEthernet usando un cable de cobre directo.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\textwidth]{Imágenes/dmzIntFis.png}
    \caption{Topología física del Switch de la DMZ Interna}
    \label{fig:dmzIntFis} 
\end{figure}

\subsubsection{Switches Core 1 y 2}
Ambos switches interconectan a los routers principales con otros doce switches de capa 3, dos de ellos interconectan con los servidores propios de las subredes IoMT e Interna; en el caso 
de la subred interna, se interconectan al servidor de archivos del hospital y al servidor DHCP de la subred interna (Figura \ref{fig:servInt}); en el caso de la subred IoMT, se interconecta a los dos servidores DHCP propios de la subred IoMT, uno de ellos funciona como backup (Figura \ref{fig:servIomT}).
El resto de switches de capa 3 son los de distribución, que actúan como puerta de entrada a las diferentes áreas del hospital (Administrativa, Quirúrgica, Médica, Servicios Generales, Enfermería y Apoyo) y a los dispositivos IoMT de cada planta del hospital (Figura \ref{fig:intIomt}).
\\ \\
Con el fin de conseguir redundancia y balanceo de carga en el cuerpo de la subred interna y subred IoMT, las conexiones entre los switches core y los switches de distribución 
siguen la topología de malla total (Figura \ref{fig:intSwitch}), mientras que las conexiones entre los switches de distribución de la subred interna siguen la topología de malla parcial, es decir, 
se conectan dos a dos (Figura \ref{fig:intSwitchDis}). En el caso de la subred IoMT no hay conexiones entre los propios switches de distribución, ya que al haber mucho tráfico por parte de los dispositivos IoMT, se podría dar la casuística de que se saturasen más fácilmente los switches de distribución (Figura \ref{fig:intSwitchiomt}).
\\ \\
Todas las conexiones entre switches de capa 3 son GigabitEthernet usando cables de cobre trenzado, mientras que las conexiones con los servidores usan cables de cobre directo.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\textwidth]{Imágenes/dmzIntFis.png}
    \caption{Topología física de los servidores de la subred interna}
    \label{fig:servInt} 
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.35\textwidth]{Imágenes/ServIoMT.png}
    \caption{Topología física de los servidores DHCP de la subred IoMT}
    \label{fig:servIomT} 
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\textwidth]{Imágenes/intiomT.png}
    \caption{Topología física de la interconexión entre switches core y switches IoMT}
    \label{fig:intIomt} 
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/intSwitches.png}
    \caption{Topología física de la interconexión entre switches de capa 3}
    \label{fig:intSwitch} 
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/intSwitDis.png}
    \caption{Topología física de la interconexión entre switches de distribución}
    \label{fig:intSwitchDis} 
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.15\textwidth]{Imágenes/intSwIomt.png}
    \caption{Topología física de la interconexión entre switches IoMT}
    \label{fig:intSwitchiomt} 
\end{figure}

\subsubsection{Switches Distribución}
Como se ha comentado anteriormente, los switches de distribución eran la puerta de entrada hacia las diferentes áreas del hospital, incluyendo a los dispositivos IoMT. Esto es así 
ya que están interconectados con los switches de acceso (capa 2), mediante enlaces FastEthernet redundantes usando cables de cobre trenzados, de esta forma en caso de fallo de uno de los enlaces 
entre los switches de distribución con los de acceso habría otro enlace que daría servicio al departamento que conecta el switch de acceso.
\\ \\
Como se puede apreciar en la Figura \ref{fig:RRHH}, en este caso es el área administrativa del hospital, cada switch de acceso conecta con un PC, una impresora y un AP, que da conectividad inalámbrica a otro tipo de dispositivos finales (smartphone y portátil).
Como se ve estos enlaces son FastEthernet usando cables de cobre directos.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Imágenes/rrhh.png}
    \caption{Topología física del área administrativa del hospital}
    \label{fig:RRHH} 
\end{figure}
Además, como se puede apreciar en la Figura \ref{fig:redundaciaARe}, cada switch de acceso está conectado a dos switches de distribución, con el fin de garantizar la tolerancia a fallos a nivel de hardware.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Imágenes/redundaciarrhh.png}
    \caption{Redundancia a nivel de hardware en área administrativa}
    \label{fig:redundaciaARe} 
\end{figure}

\subsubsection{Switches IoMT}
Como se puede apreciar en la Figura \ref{fig:iomt}, hay cuatro switches de capa 3, uno por planta para poder interconectar a los diferentes dispositivos IoMT que pueda haber en cada piso del hospital. Cada switch se conecta con 
tres APs, ya que son los necesarios para cubrir todo el área de cada planta del hospital, excepto el switch de la última planta, el cual conecta con cuatro APs, ya que en la planta 3 es donde se encuentra la UCI y por tanto 
entran en juego los tres tipos de dispositivos IoMT definidos en la sección \ref{subsec: TiposIoMT}.
Las conexiones entre los switches y los APs son Ethernet usando cables de cobre directos.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Imágenes/subrediomt.png}
    \caption{Topología física de la subred IoMT}
    \label{fig:iomt} 
\end{figure}

\subsubsection{Disposición física}
Para complementar la información dada en la sección \ref{subsec:topologiafisica}, se ha realizado un modelo en tres dimensiones del hospital Son Espases, donde se diferencian por colores 
los distintos departamentos del hospital, además de dar una pequeña visión de donde se encontrarían algunos elementos de la red, como puedan ser los switches, racks o APs.
En la Figura \ref{fig:disposic} se aprecia como en cada planta se encuentra una sala para los switches, tanto de capa 2 como de capa 3, que conectan a los diferentes departamentos divididos por colores. También se 
aprecian la ubicación de los APs que darían servicio a los dispositivos IoMT del hospital. 
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Imágenes/Plano Son Espases.png}
    \caption{Disposición física de los elementos de red}
    \label{fig:disposic} 
\end{figure}
Los elementos de red, como son los routers, switches core o servidores propios de cada subred, se encuentrán en la sala de servidores del hospital (área rosa).
\\ \\
A continuación se muestra la leyenda de la figura anterior:
\begin{itemize}
    \item \textbf{Rojo:} Área de Servicios Quirúrgicos.
    \item \textbf{Verde:} Área de Servicios Médicos.
    \item \textbf{Naranja:} Área de Servicios Centrales.
    \item \textbf{Azul:} Área de Administración.
    \item \textbf{Azul oscuro:} UCI.
    \item \textbf{Amarillo:} Área de Hospitalización.
    \item \textbf{Verde oscuro:} Área de Investigación.
    \item \textbf{Marrón:} Área de Atención al Paciente.
    \item \textbf{Rosa:} Área de Servidores y Dispositivos de Red.
    \item \textbf{Morado:} Área de Docencia.
\end{itemize}
\subsection{Topología lógica Son Espases}

La topología lógica define la organización del tráfico y las relaciones entre las distintas VLANs, subredes y servicios. 
En la red del hospital Son Espases, se distinguen 3 grandes subredes:
\begin{itemize}
    \item \textbf{Subred Interna:} Esta subred alberga las VLANs de los departamentos y servicios
 internos del hospital, garantizando la comunicación entre ellos y el acceso a los
 recursos compartidos.
    \item \textbf{Subred Invitados:} Esta subred está dedicada a los dispositivos IoMT, garantizando su
 aislamiento y seguridad, así como la monitorización de su tráfico.
    \item \textbf{Subred IoMT:} Esta subred permite el acceso a Internet y a servicios básicos
 para los dispositivos de invitados, garantizando que no interfieran con la red
 interna del hospital.
\end{itemize}

Todas estas subredes están conectadas a los tres routers principales, como se puede observar en la Figura \ref{fig:interco}. Aparte de las VLANs creadas para la DMZ y para la subred de invitados, 
también se han implementado dos VLANs con el fin de poder transmitir información entre los switches core y los routers.
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/routersLog.png}
    \caption{Topología lógica de los routers}
    \label{fig:interco} 
\end{figure}

\subsubsection{Subred interna}
Se consideran de la subred interna todos los dispositivos que tienen conectividad con los routers mediante los switches core (sin tener en cuenta los switches IoMT). Como se aprecia en la Figura \ref{fig:intercoLog} 
los dispositivos conectados a los switches core, son los switches de distribución, para que estos puedan intercambiar información y den conectividad a otros dispositivos es necesario 
implementar una VLAN dedicada (VLAN 200). Además, como también hay enlaces redundantes entre los switches de distribución, se ha implementado otra VLAN dedicada exclusivamente para estos (VLAN 205).
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/interLog.png}
    \caption{Topología lógica de la interconexión de switches L3}
    \label{fig:intercoLog} 
\end{figure}

Los switches de distribución también conectan con switches de acceso, y estos a su vez conectan a todos los dispositivos finales de los departamentos, es por eso que cada departamento 
tiene su propia VLAN, en la Figura \ref{fig:adminLog} se puede apreciar la topología lógica del área administrativa del hospital Son Espases.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Imágenes/adminLog.png}
    \caption{Topología lógica del área administrativa del hospital Son Espases}
    \label{fig:adminLog}
\end{figure}

El switch que conecta con los servidores de la subred interna está conectado a la subred de interconexión de switches de capa 3, por tanto comparten la VLAN de interconexión con los demás switches de capa 3, incluidos los IoMT, ya que aunque tengan 
una subred diferente, estos se interconectan con los switches core mediante la VLAN de interconexión de switches de capa 3 (VLAN 200).

\subsubsection{Subred de invitados}
La subred de invitados está diseñada para proporcionar acceso a Internet a los dispositivos de invitados, garantizando que no interfieran con la red interna del hospital. Esta red 
cuenta con dos switches L2 que conectan con dos Access Point (AP) que proporcionan conectividad a los dispositivos móviles de los invitados. La interconexión entre 
el router y la red de invitados se realiza a través de un switch L3, que permite la segmentación y el control del tráfico de red. La Figura \ref{fig:RedInvitados} muestra la topología 
lógica de la red de invitados.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{Imágenes/RedInvitados.png}
    \caption{Topología lógica de la Red de Invitados}
    \label{fig:RedInvitados}
\end{figure}

Esta red está muy simplificada, ya que no se han implementado configuraciones de redundancia ni de seguridad avanzadas, centrándose únicamente en la conectividad básica entre los dispositivos 
invitados y el acceso a Internet. Por supuesto, esta red es completamente escalable y se puede ampliar con los dispositivos necesarios para cumplir con futuros requisitos del sistema.

\subsubsection{Subred IoMT}
En la subred IoMT se encuentran los cuatro switches de capa 3 que interconectan a los APs de cada planta, en total hay tres APs por planta, exceptuando en la cuarta planta, donde hay 
cuatro APs, ya que se encuentra la UCI y hay que diferenciar los dispositivos IoMT de tipo 2 y 3 (detallados en la sección \ref{subsec: TiposIoMT}), ya que tienen restricciones de acceso diferentes. Es por eso que se han definido varias VLANs dependiendo 
de la planta del hospital y del tipo de dispositivo IoMT que pueda haber en esa planta.
\\ \\
Como se aprecia en la Figura \ref{fig:Rediomt}, en las tres primeras plantas solo puede haber dispositivos IoMT de tipo 1, por tanto las VLANs 210, 211, 212 tendrán el mismo control de acceso, además de la VLAN 213, que se encuentra en la cuarta planta, que también puede contener dispositivos IoMT de tipo 1.
Además, en la última planta, se han definido dos VLANs distintas (VLAN 220 y VLAN 230), para poder dar servicio a los dispositivos IoMT de tipo 2 y 3.
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/IoMT.png}
    \caption{Topología lógica de la Red IoMT}
    \label{fig:Rediomt}
\end{figure}

Como vemos estas VLANs manejan rangos de direcciones IP diferentes a las de la red interna o de invitados, de esta forma conseguimos segmentar y diferenciar claramente que dispositivos son IoMT y cuales no lo son.

\subsection{Topología Física de la Red de Interconexión entre Hospitales (cambiar)}
Este diseño es el mismo para los cuatro hospitales, permitiendo así que todos dispongan de los mismos recursos, aunque individualmente cada uno tenga sus propios departamentos.
En este diseño, el núcleo de la red es la interconexión de los cuatro hospitales, esta se lleva a cabo mediante enlaces directos, de tipo Serial, entre cada router de cada hospital, en la Figura \ref{fig:InterconexionHospitales}
se muestra la topología física de los routers de interconexión entre hospitales.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{Imágenes/InterconexionHospitales.png}
    \caption{Topología física de la Interconexión entre Hospitales}
    \label{fig:InterconexionHospitales}
\end{figure}

Como se puede apreciar en la Figura \ref{fig:InterconexionHospitales}, cada hospital tiene un único router conectado a otro router, simulando así la conexión a Internet, excepto en el caso del Hospital de Son Espases, que 
tiene dos ISPs distintos, ya que en los requisitos del sistema se definió así (\ref{análisis}). No obstante, en esta red no se ha configurado el NAT estático, por lo que no tiene relevancia la cantidad de ISPs.
\\ \\
Además, cada router de cada hospital está conectado a dos switches core (L3), mediante enlaces Ethernet usando cables de cobre directos, que son los que dan conectividad con el router a todos los dispositivos de la red interna, en la Figura 
\ref{fig:InterconexionRouHospitales} se muestra la topología física de la interconexión entre el router y los switches core. 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.3\textwidth]{Imágenes/Router-Sw.Core.png}
    \caption{Topología física de la interconexión entre el Router y los Switches Core en Hospitales}
    \label{fig:InterconexionRouHospitales}
\end{figure}

Los dos switches core también estan conectados en forma de malla con cuatro switches de distribución, mediante enlaces Ethernet usando cables de cobre trenzados, uno por cada area del hospital (Administración, Áreas Médicas, Enfermeria, Área de Apoyo). 
Con el fin de conseguir redundancia y tolerancia a fallos, estos switches de distribución se interconectan entre ellos dos a dos. En la Figura \ref{fig:InterconexionSwHospitales} se muestra la topología de interconexión entre los switches core y los switches de distribución.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\textwidth]{Imágenes/Switches.png}
    \caption{Topología física de la interconexión entre los Switches L3 en Hospitales}
    \label{fig:InterconexionSwHospitales}
\end{figure}

A su vez, los switches de distribución conectan con los switches de acceso, los cuales dan conectividad a los dispositivos finales. En la Figura \ref{fig:CLustersHospitales} se aprecia como, con fines de 
ahorrar espacio y tener la red mas ordenada, los switches de distribución se conectan con un cluster, el cual contiene los switches de acceso y por tanto las VLANs de cada departamento, separadas 
según las principales áreas del hospital.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{Imágenes/Clusters.png}
    \caption{Topología física de la interconexión con Clusters en Hospitales}
    \label{fig:CLustersHospitales}
\end{figure}

En la Figura \ref{fig:CLustersDentroHospitales} se aprecian las subredes que hay dentro de los clusters, en este caso es la subred del area de adminsitración, la cual se compone por el departamento de Recursos Humanos, Finnazas y Contabilidad, Tecnologías de la Información y Servicios Generales. Todos los enlaces 
entre los switches de acceso con dispositivos finales son Ethernet usando cables de cobre directos, exceptuando la conexión entre los APs y los dispsoitivos inalámbricos, donde se lleva a cabo una comunicación inalámbrica.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Imágenes/CLusterdentro.png}
    \caption{Topología física de la interconexión con Clusters en Hospitales}
    \label{fig:CLustersDentroHospitales}
\end{figure}


\subsection{Topología Lógica de la Red de Interconexión entre Hospitales}
En este diseño, se ha definido una VLAN por cada departamento del hospital, además de las VLANs de interconexión entre switches y routers. Además, se han definido cuatro grandes subredes:
\begin{itemize}
    \item \textbf{Subred Son Espases:} Esta subred alberga las VLANs de los departamentos y servicios internos del Hospital Son Espases, garantizando la comunicación entre ellos y el acceso a los recursos compartidos.
    \item \textbf{Subred Manacor:} Esta subred alberga las VLANs de los departamentos y servicios internos del Hospital de Manacor, garantizando la comunicación entre ellos y el acceso a los recursos compartidos.
    \item \textbf{Subred Inca:} vEsta subred alberga las VLANs de los departamentos y servicios internos del Hospital Comarcal de Inca, garantizando la comunicación entre ellos y el acceso a los recursos compartidos.
    \item \textbf{Subred Son Llàtzer:} Esta subred alberga las VLANs de los departamentos y servicios internos del Hospital Son Llàtzer, garantizando la comunicación entre ellos y el acceso a los recursos compartidos.
\end{itemize}
Cada hospital tiene su propia DMZ, donde alberga los servidores necesarios para dar los servicios al hospital y además cuenta con un servidor de archivos, que almacena información relevante del hospital, con el fin de que sea accesible por dispositivos autorizados de otros hospitales.
\\ \\
Cabe recalcar que este diseño está enfocado a la comunicación entre hospitales, y por tanto no se han implementado grandes medidas de seguridad, como por ejemplo la convivencia en la DMZ 
entre el servidor web y el servidor DHCP o el servidor de archivos.
\subsection{Descripción de Dispositivos Utilizados}

En ambos diseños se han utilizado los siguientes dispositivos:
\begin{itemize}
    \item \textbf{Routers:} Se ha utilizado el modelo \textit{Router-PT-Empty}, ya que permite añadir la cantidad de interfaces tanto GigabitEthernet como Serial necesarias para realizar 
    las conexiones.
    \item \textbf{Switches L2:} Se ha utilizado el modelo \textit{2960 IOS15}, ya que es el modelo más moderno que ofrece la herramienta Cisco Packet Tracer.
    \item \textbf{Switches L3:} Se ha utilizado el modelo \textit{3650-24PS}, ya que es el modelo más moderno que ofrece la herramienta Cisco Packet Tracer.
    \item \textbf{Puntos de Acceso Inalámbrico:} Se ha utilizado el modelo \textit{AccessPoint-PT-N}, ya que es el modelo más potente de los ofrecidos por la herramienta Cisco Packet Tracer.
    \item \textbf{Dispositivos Finales:} 
    \begin{itemize}
        \item \textbf{Portátiles:} \textit{Laptop-PT}
        \item \textbf{PCs de Escritorio:} \textit{PC-PT}
        \item \textbf{Dispositivos Móviles:} \textit{Smartphone-PT}
        \item \textbf{Impresoras:} \textit{Printer-PT}
        \item \textbf{Dispositivos IoMT:} \textit{Generic Sensor}
        \item \textbf{Servidores:} \textit{Server-PT}
    \end{itemize}
\end{itemize}

\section{VLANs y Segmentación de Red}
Uno de los elementos esenciales para garantizar la seguridad, la eficiencia y la organización de una infraestructura de red hospitalaria es la correcta segmentación del 
tráfico mediante el uso de Virtual LANs (VLANs). En este proyecto se ha diseñado una segmentación lógica basada en la estructura funcional de los hospitales, asignando una 
VLAN diferente a cada área o departamento, y separando además las subredes críticas como la de invitados y la de dispositivos IoMT.
\\ \\
Este enfoque permite aislar el tráfico de cada grupo de dispositivos, reducir la propagación de posibles ataques, evitar la congestión de tráfico y facilitar la aplicación de 
políticas de seguridad específicas entre diferentes segmentos de la red.

\subsection{Definición de VLANs por Departamento}
\label{subsec:VLANs}
Cada hospital se ha organizado internamente mediante VLANs asignadas a los diferentes departamentos y servicios. En el caso de la red de Son Espases, se han definido y configurado 
las siguientes VLANs: 
\begin{itemize}
    \item \textbf{VLAN 10:} Recursos Humanos (RRHH)
    \item \textbf{VLAN 20:} Finanzas y Contabilidad (FyC)
    \item \textbf{VLAN 30:} Oftalmología
    \item \textbf{VLAN 40:} Urología 
    \item \textbf{VLAN 50:} Cardiología
    \item \textbf{VLAN 60:} Dermatología 
    \item \textbf{VLAN 70:} Radiología 
    \item \textbf{VLAN 80:} Inmunología 
    \item \textbf{VLAN 90:} Admision
    \item \textbf{VLAN 100:} Unidad de Cuidados Intensivos (UCI)
    \item \textbf{VLAN 110:} Atencion paciente 
    \item \textbf{VLAN 120:} Asesoría Jurídica
    \item \textbf{VLAN 150:} DMZ Interna
    \item \textbf{VLAN 180:} Red Invitados
    \item \textbf{VLAN 190:} Interconexión Router-Sw.Invitados
    \item \textbf{VLAN 200:} Interconexión Switches Distribución - Switches Core
    \item \textbf{VLAN 205:} Interconexión Switches Distribución
    \item \textbf{VLAN 210:} Red IoMT Tipo 1 Planta 0
    \item \textbf{VLAN 211:} Red IoMT Tipo 1 Planta 1
    \item \textbf{VLAN 212:} Red IoMT Tipo 1 Planta 2
    \item \textbf{VLAN 213:} Red IoMT Tipo 1 Planta 3
    \item \textbf{VLAN 220:} Red IoMT Tipo 2 Planta 3
    \item \textbf{VLAN 230:} Red IoMT Tipo 3 Planta 3
    \item \textbf{VLAN 250:} Interconexión Routers - Switch Core 1
    \item \textbf{VLAN 255:} Interconexión Routers - Switch Core 2
\end{itemize}

En el caso de la red de interconexión entre hospitales, se han definido las siguientes VLANs para el hospital de Son Espases:
\begin{itemize}
    \item \textbf{VLAN 10:} Recursos Humanos (RRHH)
    \item \textbf{VLAN 20:} Finanzas y Contabilidad (FyC)
    \item \textbf{VLAN 30:} Tecnologías de la Información (IT)
    \item \textbf{VLAN 40:} Servicios Generales (SG)
    \item \textbf{VLAN 50:} Servicios Quirúrgicos (SQ)
    \item \textbf{VLAN 60:} Servicios Médicos (SM)
    \item \textbf{VLAN 70:} Servicios Centrales (SC)
    \item \textbf{VLAN 80:} Unidad de Admisión (UA)
    \item \textbf{VLAN 90:} Unidad de Cuidados Intensivos (UCI)
    \item \textbf{VLAN 100:} Servicio de Urgencias (SU)
    \item \textbf{VLAN 110:} Consultas Externas (CE)
    \item \textbf{VLAN 120:} Atención al Paciente (AP)
    \item \textbf{VLAN 130:} Asesoria Jurídica (AJ)
    \item \textbf{VLAN 140:} Docencia e Investigación (DeI)
    \item \textbf{VLAN 180:} DMZ Son Espases
    \item \textbf{VLAN 200:} Interconexión Switches Distribución - Switches Core
\end{itemize}

Para la red del Hospital de Manacor, se han definido las siguientes VLANs:
\begin{itemize}
    \item \textbf{VLAN 210:} Recursos Humanos (RRHH)
    \item \textbf{VLAN 220:} Finanzas y Contabilidad (FyC)
    \item \textbf{VLAN 230:} Tecnologías de la Información (IT)
    \item \textbf{VLAN 240:} Servicios Generales (SG)
    \item \textbf{VLAN 250:} Servicios Quirúrgicos (SQ)
    \item \textbf{VLAN 260:} Servicios Médicos (SM)
    \item \textbf{VLAN 270:} Servicios Centrales (SC)
    \item \textbf{VLAN 280:} Unidad de Admisión (UA)
    \item \textbf{VLAN 290:} Servicio de Urgencias (SU)
    \item \textbf{VLAN 300:} Consultas Externas (CE)
    \item \textbf{VLAN 310:} Atención al Paciente (AP)
    \item \textbf{VLAN 320:} Asesoria Jurídica (AJ)
    \item \textbf{VLAN 380:} Interconexión Switches Distribución - Switches Core
    \item \textbf{VLAN 400:} DMZ Manacor
\end{itemize}

Para la red del Hospital Comarcal de Inca, se han definido las siguientes VLANs:
\begin{itemize}
    \item \textbf{VLAN 410:} Recursos Humanos (RRHH)
    \item \textbf{VLAN 420:} Finanzas y Contabilidad (FyC)
    \item \textbf{VLAN 430:} Tecnologías de la Información (IT)
    \item \textbf{VLAN 440:} Servicios Generales (SG)
    \item \textbf{VLAN 450:} Servicios Quirúrgicos (SQ)
    \item \textbf{VLAN 460:} Servicios Médicos (SM)
    \item \textbf{VLAN 470:} Servicios Centrales (SC)
    \item \textbf{VLAN 480:} Unidad de Admisión (UA)
    \item \textbf{VLAN 490:} Servicio de Urgencias (SU)
    \item \textbf{VLAN 500:} Consultas Externas (CE)
    \item \textbf{VLAN 510:} UCI (Unidad de Cuidados Intensivos)
    \item \textbf{VLAN 520:} Atención al Paciente (AP)
    \item \textbf{VLAN 530:} Asesoria Jurídica (AJ)
    \item \textbf{VLAN 580:} Interconexión Switches Distribución - Switches Core
    \item \textbf{VLAN 600:} DMZ Inca
\end{itemize}

Para la red del Hospital Son Llàtzer, se han definido las siguientes VLANs:
\begin{itemize}
    \item \textbf{VLAN 610:} Recursos Humanos (RRHH)
    \item \textbf{VLAN 620:} Finanzas y Contabilidad (FyC)
    \item \textbf{VLAN 630:} Tecnologías de la Información (IT)
    \item \textbf{VLAN 640:} Servicios Generales (SG)
    \item \textbf{VLAN 650:} Servicios Quirúrgicos (SQ)
    \item \textbf{VLAN 660:} Servicios Médicos (SM)
    \item \textbf{VLAN 670:} Servicios Centrales (SC)
    \item \textbf{VLAN 680:} Unidad de Admisión (UA)
    \item \textbf{VLAN 690:} Servicio de Urgencias (SU)
    \item \textbf{VLAN 700:} Consultas Externas (CE)
    \item \textbf{VLAN 710:} UCI (Unidad de Cuidados Intensivos)
    \item \textbf{VLAN 720:} Atención al Paciente (AP)
    \item \textbf{VLAN 730:} Asesoria Jurídica (AJ)
    \item \textbf{VLAN 740:} DeI (Docencia e Investigación)
    \item \textbf{VLAN 780:} Interconexión Switches Distribución - Switches Core
    \item \textbf{VLAN 800:} DMZ Son Llàtzer
\end{itemize}

En el caso de la red de Son Espases, se ha optado por configurar solamente los departamentos mostrados anteriormente, realmente hay muchos mas departamentos \cite{GerenciaSonEspases}, pero con el objetivo
de no duplicar esfuerzos en la configuración de dispositivos no representativos, se ha optado por no configurar el resto de departamentos.
\\ \\
En el caso de la red de interconexión entre hospitales, se ha optado por configurar todos los departamentos de los hospitales, con el fin de probar la conectividad desde cualquier area o 
departamento de un hospital a cualquier area o departamento de otro hospital.

\subsection{Configuración de Troncales y Acceso a VLANs}
Para garantizar el correcto funcionamiento de las VLANs y la segmentación del tráfico, es necesario configurar los puertos de los switches siguiendo el siguiente criterio:
\begin{itemize}
    \item \textbf{Switches de Acceso (L2)} 
    \begin{itemize}
        \item \textbf{FastEthernet:} Son los puertos que conectan con los dispositivos finales (PCs, impresoras, servidores, etc.), se configuran en modo acceso, asignándolos a la VLAN correspondiente 
        del departamento o servicio al que pertenecen.
        \item \textbf{GigabitEthernet:} Son los puertos que conectan con los switches de distribución o routers (en el caso de los switches del DMZ), se configuran en modo troncal, permitiendo el tráfico de la VLAN definida en ese departamento o servicio.
    \end{itemize}
    \item \textbf{Switches de Distribución (L3):} Todos los puertos deben estar configurados en modo troncal, permitiendo el tráfico de todas las VLANs necesarias.
    \item \textbf{Switches Core (L3):} Todos los puertos conectados a los switches de distribución deben estar configurados en modo troncal, permitiendo el tráfico de todas las VLANs necesarias. Los puertos que conectan con los routers 
    tienen dirección IP estática y por lo tanto no se configura el switchport en modo troncal.
\end{itemize}

\section{Direccionamiento IP y Subnetting}\label{sec:direccionamiento}
Un correcto esquema de direccionamiento IP es esencial para garantizar la organización, la escalabilidad y la seguridad de cualquier infraestructura de red. En entornos 
hospitalarios, donde coexisten diferentes tipos de dispositivos y servicios con requisitos de conectividad y seguridad distintos, la planificación del direccionamiento 
cobra especial relevancia.
\\ \\
Para este proyecto se ha diseñado un esquema jerárquico y estructurado, basado en subredes independientes para cada entorno funcional y departamental, facilitando la 
segmentación del tráfico, la implementación de políticas de seguridad y la gestión de direcciones IP.

\subsection{Criterios de Diseño de Direccionamiento}
El esquema de direccionamiento se ha planificado atendiendo a los siguientes criterios:
\begin{itemize}
    \item Separación de subredes por tipo de servicio: red de invitados, red IoMT y red interna hospitalaria.
    \item Uso de rangos de direcciones IP privadas (192.168.0.0/16, 172.16.0.0/12 y 10.0.0.0/8), según las recomendaciones de la \ac{RFC} 1918.
    \item Evitar solapamientos entre subredes y facilitar su integración en redes hospitalarias de mayor escala.
    \item Facilitar la implementación de ACLs y políticas de seguridad basadas en rangos de IP.
    \item Garantizar escalabilidad para añadir nuevos dispositivos, departamentos o servicios en el futuro.
\end{itemize}

\subsection{Planificación de Subredes}
En el diseño de la red del Hospital de Son Espases, se han definido tres grandes subredes principales:
\begin{itemize}
    \item \textbf{Red Invitados:} 192.168.0.0/16
    \item \textbf{Red Interna:} 10.0.0.0/8
    \item \textbf{Red IoMT:} 172.16.0.0/12
\end{itemize}
Aparte de estas redes también están las subredes de interconexión entre switches y routers. En la tabla \ref{tab:subnettingSonEspases} podemos ver el subnetting completo de la red del Hospital de 
Son Espases. En la tabla se puede apreciar que hay 5 columnas, a continuación se muestra una breve descripción de cada una:
\begin{enumerate}
    \item \textbf{Departamento:} Es el nombre del área o servicio funcional al que pertenece esa subred o VLAN. Por ejemplo: UCI.
    \item \textbf{Network Address:} Es la dirección de red que identifica a toda la subred. Es la primera dirección del bloque de direcciones IP asignadas a esa subred 
    y no puede asignarse a ningún dispositivo. Sirve para que los routers y switches reconozcan la red en su tabla de enrutamiento. Por ejemplo: 192.168.0.0.
    \item \textbf{Máscara de Subred:} Es el valor que determina cuántos bits se utilizan para identificar la parte de red y cuántos para los hosts dentro de esa subred. 
    Se expresa en notación decimal punteada, por ejemplo 255.255.255.0.
    \item \textbf{Rango de Direcciones Host:} Indica las direcciones IP que se pueden asignar a dispositivos dentro de esa subred. Es el intervalo de direcciones 
    comprendido entre la primera dirección válida y la dirección anterior a la de broadcast. Por ejemplo, 192.168.0.1-192.168.0.63.
    \item \textbf{Dirección Broadcast:} Es la última dirección de cada subred. Se utiliza para enviar mensajes simultáneos a todos los dispositivos de esa subred. No se 
    puede asignar a ningún dispositivo. Por ejemplo, 192.168.0.255 para la subred 192.168.0.0/24.
\end{enumerate}

{\small \textbf{Nota: }\textit{Las VLANs correspondientes a cada subred están definidas en la sección \ref{subsec:VLANs}}}

\subsubsection{Subnetting Son Espases}
En la Tabla \ref{tab:subnettingSonEspases} se muestra en detalle el subnetting realizado en la red interna del Hospital Son Espases.

\renewcommand{\arraystretch}{1.3}
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|c|c|c|}
        \hline
        \textbf{Departamento} & \textbf{Network Address} & \textbf{Máscara de Subred} & \textbf{Direcciones Host} & \textbf{Dirección Broadcast} \\
        \hline
        Recursos Humanos & 10.0.0.0 & 255.255.255.192 & 10.0.0.1 - 10.0.0.62 & 10.0.0.63 \\
        \hline
        Contabilidad & 10.0.0.64 & 255.255.255.192 & 10.0.0.65 - 10.0.0.126 & 10.0.0.127 \\
        \hline
        Oftalmología & 10.0.0.128 & 255.255.255.192 & 10.0.0.129 - 10.0.0.190 & 10.0.0.191 \\
        \hline
        Urología & 10.0.0.192 & 255.255.255.192 & 10.0.0.193 - 10.0.0.254 & 10.0.0.255 \\
        \hline
        Cardiología & 10.0.1.0 & 255.255.255.192 & 10.0.1.1 - 10.0.1.62 & 10.0.1.63 \\
        \hline
        Dermatología & 10.0.1.64 & 255.255.255.192 & 10.0.1.65 - 10.0.1.126 & 10.0.1.127 \\
        \hline
        Radiología & 10.0.1.128 & 255.255.255.192 & 10.0.1.129 - 10.0.1.190 & 10.0.1.191 \\
        \hline
        Inmunología & 10.0.1.192 & 255.255.255.192 & 10.0.1.193 - 10.0.1.254 & 10.0.1.255 \\
        \hline
        Unidad Admisión & 10.0.2.0 & 255.255.255.192 & 10.0.2.1 - 10.0.2.62 & 10.0.2.63 \\
        \hline
        UCI & 10.0.2.64 & 255.255.255.192 & 10.0.0.65 - 10.0.2.126 & 10.0.2.127 \\
        \hline
        Atención Paciente & 10.0.2.128 & 255.255.255.192 & 10.0.2.129 - 10.0.2.190 & 10.0.2.191 \\
        \hline
        Asesoría Jurídica & 10.0.2.192 & 255.255.255.192 & 10.0.2.193 - 10.0.2.254 & 10.0.2.255 \\
        \hline
        DMZ & 10.0.3.0 & 255.255.255.240 & 10.0.3.1 - 10.0.3.14 & 10.0.3.15 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interna Son Espases}
    \label{tab:subnettingSonEspases}
\end{table}

En las Tablas \ref{tab:InterconexionCoreSE}, \ref{tab:InterconexionDistrSE}, \ref{tab:InterconexionCore1-RouterSE}, \ref{tab:InterconexionCore2-RouterSE} y \ref{tab:InterconexionRouter-ISPSE},
se pueden apreciar el subnetting de las interconexiones anteriormente mencionadas.
\renewcommand{\arraystretch}{1.5}
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivos} & \textbf{Dirección IP} \\
        \hline
        Switch Distribución 1 (Administración) & 10.1.0.1 \\
        \hline
        Switch Distribución 2 (Serv. Quirúrgicos) & 10.1.0.2 \\
        \hline
        Switch Distribución 3 (Serv. Médicos) & 10.1.0.3 \\
        \hline
        Switch Distribución 4 (Serv. Centrales) & 10.1.0.4 \\
        \hline
        Switch Distribución 5 (Enfermería) & 10.1.0.5 \\
        \hline
        Switch Distribución 6 (Apoyo) & 10.1.0.6 \\
        \hline
        Switch Core 1 & 10.1.0.7 \\
        \hline
        Switch Core 2 & 10.1.0.8 \\
        \hline
        Switch IoMT-P0 & 10.1.0.9 \\
        \hline
        Switch IoMT-P1 & 10.1.0.10 \\
        \hline
        Switch IoMT-P2 & 10.1.0.11 \\
        \hline
        Switch IoMT-P3 & 10.1.0.12 \\
        \hline
        Switch DHCP Interno & 10.1.0.13 \\
        \hline
        Switch DHCP IoMT & 10.1.0.15 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interconexión Switches L3}
    \label{tab:InterconexionCoreSE}
\end{table}

\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Dirección IP} \\
        \hline
        Switch Distribución 1 (Administración) & 10.1.1.1 \\
        \hline
        Switch Distribución 2 (Serv. Quirúrgicos) & 10.1.1.2 \\
        \hline
        Switch Distribución 3 (Serv. Médicos) & 10.1.1.3 \\
        \hline
        Switch Distribución 4 (Serv. Centrales) & 10.1.1.4 \\
        \hline
        Switch Distribución 5 (Enfermería) & 10.1.1.5 \\
        \hline
        Switch Distribución 6 (Apoyo) & 10.1.1.6 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interconexión Switches Distribuidores}
    \label{tab:InterconexionDistrSE}
\end{table}

\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Dirección IP} \\
        \hline
        IP Virtual & 10.2.0.1 \\
        \hline
        Router Principal & 10.2.0.2 \\
        \hline
        Router Auxiliar 1 & 10.2.0.3 \\
        \hline
        Router Auxiliar 2 & 10.2.0.4 \\
        \hline
        Switch Core 1 & 10.2.0.5 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interconexión Switch Core 1 - Routers}
    \label{tab:InterconexionCore1-RouterSE}
\end{table}

\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Dirección IP} \\
        \hline
        IP Virtual & 10.2.1.1 \\
        \hline
        Router Principal & 10.2.1.2 \\
        \hline
        Router Auxiliar 1 & 10.2.1.3 \\
        \hline
        Router Auxiliar 2 & 10.2.1.4 \\
        \hline
        Switch Core 1 & 10.2.1.5 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interconexión Switch Core 2 - Routers}
    \label{tab:InterconexionCore2-RouterSE}
\end{table}

\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|l|c|}
        \hline
        \textbf{Dispositivo 1} & \textbf{Dirección IP 1} & \textbf{Dispositivo 2} & \textbf{Dirección IP 2}\\
        \hline
        Router Principal & 195.136.17.2 & ISP 1 & 195.136.17.1 \\
        \hline
        Router Principal & 195.136.17.6 & ISP 2 & 195.136.17.5 \\
        \hline
        Router Auxiliar 1 & 195.136.17.10 & ISP 1 & 195.136.17.9 \\
        \hline
        Router Auxiliar 1 & 195.136.17.14 & ISP 2 & 195.136.17.13 \\
        \hline
        Router Auxiliar 2 & 195.136.17.18 & ISP 1 & 195.136.17.17 \\
        \hline
        Router Auxiliar 2 & 195.136.17.22 & ISP 2 & 195.136.17.21 \\
        \hline
    \end{tabular}
    \caption{Subnetting Red Interconexión Routers - ISPs}
    \label{tab:InterconexionRouter-ISPSE}
\end{table}

En la Tabla \ref{tab:InterconexionRouter-ISPSE} se puede apreciar que la red del Hospital Son Espases tiene como direcciones IP hacia Internet las siguientes:
\begin{itemize}
    \item 195.136.17.1 (ISP 1)
    \item 195.136.17.9 (ISP 1)
    \item 195.136.17.17 (ISP 1)
\end{itemize}
Y que las direcciones IP desde Internet hacia la red de Son Espases son las siguientes:
\begin{itemize}
    \item 195.136.17.5 (ISP 2)
    \item 195.136.17.13 (ISP 2)
    \item 195.136.17.21 (ISP 2)
\end{itemize}

\subsubsection{Subnetting IoMT}
En la Tabla \ref{tab:subnettingIoMT} se muestra en detalle el subnetting realizado en la subred IoMT del Hospital Son Espases.

\renewcommand{\arraystretch}{1.3}
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|c|c|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Network Address} & \textbf{Máscara de Subred} & \textbf{Direcciones Host} & \textbf{Dirección Broadcast} \\
        \hline
        IoMT Tipo 1 Planta 0 & 172.16.0.0 & 255.255.240.0 & 172.16.0.1 - 172.16.15.254 & 172.16.15.255 \\
        \hline
        IoMT Tipo 1 Planta 1 & 172.16.16.0 & 255.255.240.0 & 172.16.16.1 - 10.0.0.126 & 172.16.31.255 \\
        \hline
        IoMT Tipo 1 Planta 2 & 172.16.32.0 & 255.255.240.0 & 172.16.32.1 - 10.0.0.190 & 172.16.47.255 \\
        \hline
        IoMT Tipo 1 Planta 3 & 172.16.48.0 & 255.255.240.0 & 172.16.48.1 - 10.0.0.254 & 172.16.63.255 \\
        \hline
        IoMT Tipo 2 & 172.16.64.0 & 255.255.192.0 & 172.16.64.1 - 172.64.127.254 & 172.16.127.255 \\
        \hline
        IoMT Tipo 3 & 172.16.128.0 & 255.255.192.0 & 172.16.128.1 - 172.128.191.254 & 172.16.191.255 \\
        \hline
    \end{tabular}
    \caption{Subnetting subred IoMT Son Espases}
    \label{tab:subnettingIoMT}
\end{table}

\subsubsection{Subnetting Invitados}
En la Tabla \ref{tab:subnettingInvitados} se muestra en detalle el subnetting realizado en la subred de invitados del Hospital Son Espases.

\renewcommand{\arraystretch}{1.3}
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|c|c|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Network Address} & \textbf{Máscara de Subred} & \textbf{Direcciones Host} & \textbf{Dirección Broadcast} \\
        \hline
        Invitados & 192.168.0.0 & 255.255.128.0 & 192.168.0.1 - 192.168.127.254 & 192.168.127.255 \\
        \hline
    \end{tabular}
    \caption{Subnetting subred invitados Son Espases}
    \label{tab:subnettingInvitados}
\end{table}

En la Tabla \ref{tab:subnettingIntInvitados} se muestra el subnetting realizado en la interconexión de los routers con el switch de acceso de la subred de invitados.
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Dirección IP} \\
        \hline
        IP Virtual & 192.168.130.1 \\
        \hline
        Router Principal & 192.168.130.2 \\
        \hline
        Router Auxiliar 1 & 192.168.130.3 \\
        \hline
        Router Auxiliar 2 & 192.168.130.4 \\
        \hline
        Switch Invitados & 192.168.130.5 \\
        \hline
    \end{tabular}
    \caption{Subnetting interconexión subred invitados Son Espases}
    \label{tab:subnettingIntInvitados}
\end{table}

\subsection{Asignación de Direcciones IP Estáticas}\label{subsec:estaticas}
Para el correcto funcionamiento de la red, es necesaria la definición de direcciones IP estáticas como por ejemplo las de las puertas de enlace o 
la de los servidores que dan servicios esenciales a la red interna, como el servidor DHCP.

\subsubsection{Puertas de Enlace}
En el diseño de la red de Son Espases, cada VLAN, excepto las de interconexión entre switches de distribución y switches core (que no tienen puerta de enlace), tiene su puerta de enlace configurada en los switches de distribución, ya que son los que permiten el enrutamiento. En la Tabla \ref{tab:GatewaysSE} se presentan las puertas de enlace de la red del Hospital Son Espases.
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{VLAN} & \textbf{Dirección IP} \\
        \hline
        10 & 10.0.0.1 \\
        \hline
        20 & 10.0.0.65 \\
        \hline
        30 & 10.0.0.129 \\
        \hline
        40 & 10.0.0.193 \\
        \hline
        50 & 10.0.1.1 \\
        \hline
        60 & 10.0.1.65 \\
        \hline
        70 & 10.0.1.129 \\
        \hline
        80 & 10.0.1.193 \\
        \hline
        90 & 10.0.2.1 \\
        \hline
        100 & 10.0.2.65 \\
        \hline
        110 & 10.0.2.129 \\
        \hline
        120 & 10.0.2.193 \\
        \hline
        150 & 10.0.3.1 \\
        \hline
        180 & 192.168.0.1 \\
        \hline
        190 & 192.168.130.1 \\
        \hline
        210 & 172.16.0.1 \\
        \hline
        211 & 172.16.16.1 \\
        \hline
        212 & 172.16.32.1 \\
        \hline
        213 & 172.16.48.1 \\
        \hline
        220 & 172.16.64.1 \\
        \hline
        230 & 172.16.128.1 \\
        \hline
        250 & 10.2.0.1 \\
        \hline
        255 & 10.2.1.1 \\
        \hline
    \end{tabular}
    \caption{Direcciones IP estáticas de las puertas de enlace de Son Espases}
    \label{tab:GatewaysSE}
\end{table}

Las VLANs de interconexión 200 y 205 no tienen puertas de enlace, porque son VLANs en el que todos los puertos de los dispositivos implicados están configurados en modo troncal.

\subsubsection{Servidores}
Para que los dispositivos tengan una dirección IP de referencia para poder acceder a los servidores, es necesario que esta sea estática, por eso a cada servidor de cada DMZ se le ha asignado una dirección IP estática.
La Tabla \ref{tab:servidoresSE} muestra las direcciones IP de todos los servidores de la red del Hospital Son Espases.
\begin{table}[H]
    \centering
    \scriptsize
    \begin{tabular}{|l|c|}
        \hline
        \textbf{Dispositivo} & \textbf{Dirección IP} \\
        \hline
        Servidor DHCP Interno & 10.1.0.14 \\
        \hline
        Servidor de Archivos Interno & 10.1.0.17 \\
        \hline
        Servidor DHCP Invitados & 192.168.0.5 \\
        \hline
        Servidor Web & 10.0.3.7 \\
        \hline
        Servidor DHCP IoMT & 10.1.0.16 \\
        \hline
    \end{tabular}
    \caption{Direcciones IP estáticas de los servidores de Son Espases}
    \label{tab:servidoresSE}
\end{table}

\subsubsection{Dispositivos Finales}
Para garantizar las restricciones de acceso necesarias en los accesos a los dispositivos IoMT de tipo 3, se ha definido que un dispositivo del departamento de la UCI tenga una dirección IP estática, 
en este caso el PC de escritorio es el que tiene la dirección IP estática, que es 10.0.2.70. 
\\ \\
Además, normalmente las impresoras también tienen direcciones IPs estáticas, para evitar problemas con el controlador de impresión, por eso en la red del hospital Son Espases, se ha 
definido que las impresoras tengan la cuarta dirección IP disponible para hosts de cada VLAN, así por ejemplo la impresora de la VLAN 10, tiene asignada la dirección IP 10.0.0.5 \cite{Impresoras}.

\section{Protocolos y Servicios de Red}
Para garantizar el correcto funcionamiento, la conectividad eficiente y la seguridad de la infraestructura hospitalaria diseñada, se han configurado una serie de protocolos 
de red y servicios esenciales. Estos protocolos permiten automatizar la asignación de direcciones, gestionar la conectividad entre dispositivos y hospitales, proteger las 
comunicaciones y asegurar la alta disponibilidad en los puntos críticos de la red.

\subsection{Dynamic Host Configuration Protocol (DHCP)}
El Dynamic Host Configuration Protocol (DHCP) se ha configurado para realizar la asignación automática de direcciones IP a los dispositivos finales conectados en cada subred y VLAN, según se detalla en la sección \ref{subsec:dhcp}.
\\ \\
En el caso de la red del Hospital Son Espases, cuenta con:
\begin{itemize}
    \item Un servidor DHCP en la DMZ Interna, que se encarga de asignar direcciones IP a cada dispositivo final de las red interna.
    \item Un servidor DHCP en la DMZ Invitados, que se encarga de asignar direcciones IP a cada dispositivo final de la red de invitados.
    \item Dos servidores DHCP en la DMZ IoMT, que se encargan de asignar direcciones IP a cada dispositivo IoMT de la red IoMT. En este caso, uno funciona de backup, para que en caso de fallada del servidor principal, los dispositivos IoMT sigan teniendo este servicio.
\end{itemize}
Los servidores están configurados con pools de direcciones, de forma que asignan IPs dinámicas a los dispositivos de cada VLAN, siguiendo el subnetting mostrado en la sección \ref{tab:subnettingSonEspases}.
\\ \\
Mediante el uso de este servicio obtenemos las siguientes ventajas:
\begin{itemize}
    \item Evitar conflictos de direcciones IP.
    \item Facilitar la gestión de direcciones en entornos con alta densidad de dispositivos.
    \item Separar la asignación de IPs entre subredes, manteniendo su aislamiento lógico.
\end{itemize}
En el caso de la red de interconexión entre hospitales, se cuenta con un servidor DHCP en la DMZ de cada hospital, que se encarga de asignar direcciones IP a cada dispositivo final del hospital. \\ \\
Cabe recordar que en la herramienta Cisco Packet Tracer no se puede configurar la opción de DHCP failover, por eso el concepto de implementar dos servidores DHCP es teórico y no es demostrable en este proyecto.

\subsection{Network Address Translation (NAT)}
Para permitir la salida controlada a Internet desde las subredes autorizadas, se ha implementado Network Address Translation (NAT) en los routers de cada hospital, 
según se detalla en la sección \ref{subsec:nat}. En ambos diseños, el NAT está configurado en los routers principales, permitiendo así que los dispositivos internos puedan acceder a Internet utilizando la misma IP pública. El tipo de 
NAT configurado, en el caso de la comunicación desde dentro hacia fuera, es el PAT, lo que permite que múltiples dispositivos puedan utilizar la IP pública usando diferentes números de puerto para distinguir las conexiones. En el caso de las comunicaciones desde Internet hacia dentro (servidor web), se ha configurado un NAT estático, lo que permite que 
el router traduzca la dirección pública proveniente del ISP y permitir la conexión con el servidor web, que tiene una IP privada.
\\ \\
En este diseño, se ha optado por que las comunicaciones que vayan desde dentro hacia fuera pasen por el ISP 1 y las comunicaciones desde fuera hacia dentro lo hagan por el ISP 2, de esta forma 
permitimos que las NATs estén bien configuradas y que no solapen las IPs públicas de las interfaces.
\subsection{Hot Standby Router Protocol (HSRP)}
Para garantizar la alta disponibilidad en los gateways de las redes internas y evitar puntos únicos de fallo, se ha configurado HSRP, para mas información sobre HSRP ir a la sección \ref{subsec:hsrp}. 
Como se ha comentado en la sección \ref{sec:criterios}, la redundancia de routers o switches solo se ha configurado en la red del Hospital Son Espases. Concretamente, se ha configurado en los switches de distribución 
que conectan con los switches de acceso, como se puede apreciar en la Figura \ref{fig:HSRPSW}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{Imágenes/hsrpSW.png}
    \caption{HSRP en switches de distribución en Hospital Son Espases}
    \label{fig:HSRPSW}
\end{figure}

También se ha configurado HSRP en los routers principales, permitiendo así que haya dos routers de repuesto por si el router principal falla y deja de dar servicio. En la Figura \ref{fig:HSRPRou} 
se pueden apreciar los tres routers redundantes.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{Imágenes/HSRProut.png}
    \caption{HSRP en Routers en Hospital Son Espases}
    \label{fig:HSRPRou}
\end{figure}

\subsection{Open Shortest Path First (OSPF)}
Como protocolo de enrutamiento dinámico se ha implementado OSPF, detallado en la sección \ref{subsec:ospf}, 
tanto en la red del Hospital Son Espases como en la red de interconexión entre hospitales. 
\\ \\
En el caso de la red del Hospital Son Espases, se ha añadido una configuración extra, que permite definir el coste de las rutas OSPF, de esta forma se ha configurado la red de 
interconexión entre switches de distribución y switches core para que tengan un coste de 10, mientras que la red de interconexión de switches de distribución tengan un coste de 100. De
 esta forma se fuerza a que las comunicaciones se hagan directamente entre los switches de distribución y los switches core y que las conexiones entre los switches de distribución sean meramente redudnantes y que no 
congestionen la red innecesariamente.
\\ \\
El protocolo OSPF se ha configurado, en ambos diseños, en cada switch L3 y en los routers, ya que son los dispositivos de red que tienen capacidad de enrutamiento.

\subsection{EtherChannel}
Para aumentar el ancho de banda y proporcionar redundancia en los enlaces entre switches de distribución y switches de acceso, se ha configurado EtherChannel, detallado en la sección \ref{subsec:etherchannel}.
\\ \\
Como se ha comentado en la sección \ref{sec:criterios}, la redundancia a nivel de enlaces solo se ha configurado en la red del Hospital de Son Espases. A causa de las limitaciones de la herramienta Cisco Packet Tracer, referenciadas en la sección \ref{subsec:limites},
solo se ha podido implementar en algunas conexiones entre switches de acceso y switches de distribución, lo ideal sería implementarlo en tramos de mucho tráfico y en tramos donde hay una conexión entre elementos críticos, como por ejemplo la conexión entre los routers y los switches core.
\\ \\
En la Figura \ref{fig:EtherChannel} se muestra una conexión redundante a nivel de enlace en la red del Hospital Son Espases.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{Imágenes/Etherchannel.png}
    \caption{EtherChannel entre Switches de Acceso y Distribución en Hospital Son Espases}
    \label{fig:EtherChannel}
\end{figure}

\subsection{RSTP (Rapid Spanning-Tree Protocol)}
RSTP (Rapid Spanning Tree Protocol) es una versión mejorada del protocolo STP (Spanning Tree Protocol), diseñado para prevenir bucles en redes Ethernet que utilizan switches.
\\ \\
En el caso de ambas redes, RSTP se configura en todos los switches de interconexión, es decir, los switches de capa 3.

\section{Seguridad de la Red}
El diseño de la infraestructura de red hospitalaria simulada ha priorizado desde el inicio la seguridad como pilar esencial, dada la sensibilidad de los datos clínicos que se 
gestionan y la criticidad de los servicios asistenciales que dependen de ella. Además, la incorporación de dispositivos médicos conectados (IoMT) requieren unos controles de tráfico y 
acceso mas robustos.
\\ \\
En esta sección, se detallan las medidas de seguridad adopatadas en ambos diseños de red.
\subsection{ACLs}\label{subsec:acls}
Las ACLs permiten tener un control del tráfico que pasa por ciertos tramos, es por eso que, siguiendo con los requisitos establecidos en la sección \ref{subsec: TiposIoMT}, se han implementado las siguientes ACLs:
\begin{itemize}
    \item \textbf{En los routers:} 
    \begin{itemize}
        \item Permitir la conexión con Internet a los dispositivos de la red de invitados (ACL extendida).
        \item Permitir la conexión desde Internet hasta el servidor web (ACL extendida).
        \item Permitir paquetes OSPF y HSRP (ACL estándar).
        \item Denegar cualquier otro tipo de tráfico (ACL estándar).
    \end{itemize}
    \item \textbf{Switch IoMT Planta 3:}
    \begin{itemize}
        \item Permitir la conexión de los dispositivos IoMT de tipo 1 con dispositivos de las áreas de servicios quirúrgicos, médicos y centrales (ACL extendida).
        \item Permitir la conexión de los dispositivos IoMT de tipo 2 con dispositivos del departamento de la UCI (ACL extendida).
        \item Permitir la conexión de los dispositivos IoMT de tipo 3 con el dispositivo autorizado de la UCI (ACL extendida).
        \item Permitir paquetes DHCP y OSPF (ACL estándar).
        \item Denegar cualquier otro tipo de tráfico (ACL estándar).
    \end{itemize}
    \item \textbf{Switch IoMT Planta 0, 1 y 2:}
    \begin{itemize}
        \item Permitir la conexión de los dispositivos IoMT de tipo 1 con dispositivos de las áreas de servicios quirúrgicos, médicos y centrales (ACL extendida).
        \item Permitir paquetes DHCP y OSPF (ACL estándar).
        \item Denegar cualquier otro tipo de tráfico (ACL estándar).
    \end{itemize}
    \item \textbf{Switches de Distribución:}
    \begin{itemize}
        \item Denegar la salida de paquetes hacia las áreas de servicios quirúrgicos, médicos y centrales (ACL extendida).
        \item Permitir cualquier otro tipo de tráfico (ACL estándar).
    \end{itemize}
    \item \textbf{Routers de la red de interconexión:}
    \begin{itemize}
        \item Denegar la conexión entre los dispositivos no autorizados con el servidor de archivos (ACL extendida).
        \item Denegar la conexión entre los dispositivos de otros hospitales con dispositivos del hospital (ACL extendida).
        \item Permitir cualquier otro tipo de tráfico (ACL estándar).
    \end{itemize}
\end{itemize}

\subsection{DHCP Snooping}
Para evitar ataques de DHCP Spoofing, se ha configurado DHCP Snooping en todos los switches de acceso que no tengan enlaces redundantes (EtherChannel), ya que la herramienta Cisco Packet Tracer no permite 
configurar DHCP Spoofing en enlaces redundantes. Con la configuración de este mecanismo de seguridad, conseguimos que los dispositivos finales solo acepten las direcciones IP dadas por los servidores DHCP autorizados, 
ya que el switch de acceso descarta cualquier oferta de dirección IP proveniente de un servidor DHCP no autorizado \cite{cisco_dhcp_snooping}.
\\ \\
También se ha configurado la opción de limitar la cantidad de paquetes DHCP enviados al servidor DHCP para evitar saturaciones (DHCP Starvation).
\\ \\
Este mecanismo de seguridad solo está configurado en la red del Hospital de Son Espases.

\subsection{VPN IPSec}
Para proprocionar seguridad a las interconexiones entre los routers de cada hospital, se ha configurado una VPN IPsec, detallada en la sección \ref{subsec:ipsec}, en la que se encriptan y autentican todos los paquetes IP que se transmiten a través de esa conexión.
De esta forma conseguimos una gran capa de seguridad que nos garantiza la confidencialidad, integridad y autenticidad de los datos que viajan por esa red IP.
\\ \\
Este mecansimo de seguridad solo se ha implementado en la red de interconexión entre hospitales, ya que la red del Hospital Son Espases no tiene conexiones entre routers de otros hospitales. 
Además cabe recordar que la comunicación entre hospitales solo se puede realizar entre el dispositivo autorizado de un hospital con el servidor de archivos de otro hospital.

\subsection{Secure Shell (SSH)}
Para la administración remota segura de los dispositivos de red (routers y switches), se ha habilitado SSH como protocolo seguro de gestión, en sustitución de protocolos inseguros como Telnet. 
Esta configuración se ha implementado en todos los dispositivos de red (switches L2, switches L3 y routers). 

\subsection{Configuración DMZ}\label{subsec:dmz}
Para que la DMZ sea una zona segura para los servidores, se han implementado una serie de mecanismos de seguridad:
\begin{itemize}
    \item \textbf{switchport port-security maximum 1.} Limita el número máximo de direcciones \ac{MAC} permitidas en el puerto a 1.
    \item \textbf{switchport port-security mac-address sticky.} Activa el aprendizaje automático de direcciones MAC en modo \textit{sticky}, estas direcciones se almacenan en la configuración de ejecución, permitiendo que el puerto solo acepte dispositivos previamente conectados sin necesidad de configurar manualmente cada MAC.
    \item \textbf{switchport port-security violation shutdown.} Deshabilita el puerto automáticamente cuando se detecta una violación de seguridad (por ejemplo, la conexión de un dispositivo con una MAC diferente a la permitida).
\end{itemize}

\section{Redes Completas}

Para ver las redes completas de la red del Hospital Son Espases y la red de interconexión entre hospitales, ver el anexo \ref{anexo:redcompletasonespas} y \ref{anexo:redcompletahosp}, respectivamente.

